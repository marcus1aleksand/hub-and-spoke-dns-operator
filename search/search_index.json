{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Home","text":""},{"location":"#hub-and-spoke-dns-operator","title":"Hub and Spoke DNS Operator","text":""},{"location":"#hub-and-spoke-dns-operator_1","title":"Hub and Spoke DNS Operator","text":"<p> A multi-cloud Kubernetes operator that automatically manages DNS records for Ingress resources \u2014 purpose-built for hub-and-spoke network architectures. </p> <p>Get Started  View on GitHub </p>"},{"location":"#key-features","title":"Key Features","text":""},{"location":"#multi-cloud-support","title":"Multi-Cloud Support","text":"<p>Manage DNS records across Azure DNS, Google Cloud DNS, and AWS Route53 with a single operator deployment.</p>"},{"location":"#event-driven","title":"Event-Driven","text":"<p>Watches Kubernetes Ingress events in real-time \u2014 DNS records are created, updated, and deleted automatically.</p>"},{"location":"#secure-by-default","title":"Secure by Default","text":"<p>Uses managed identities, IRSA, and workload identity. No hardcoded credentials. Minimal RBAC. Non-root container.</p>"},{"location":"#observable","title":"Observable","text":"<p>Built-in Prometheus metrics for operations, latency, and error tracking. ServiceMonitor support included.</p>"},{"location":"#helm-ready","title":"Helm-Ready","text":"<p>Production-ready Helm chart with full configurability. Install in one command from GHCR.</p>"},{"location":"#flexible-ip-override","title":"Flexible IP Override","text":"<p>Use a custom IP (e.g., firewall NAT IP) instead of the Ingress load balancer IP for hub-and-spoke topologies.</p>"},{"location":"#how-it-works","title":"How It Works","text":"<p>The operator is designed for hub-and-spoke network topologies where Kubernetes clusters run in spoke networks behind a central hub firewall with NAT rules.</p> <pre><code>graph LR\n    ING[\"\u2638\ufe0f Ingress Event\"] --&gt; OP[\"\u2699\ufe0f DNS Operator\"]\n    OP --&gt; |Azure| AZ[\"Azure DNS\"]\n    OP --&gt; |GCP| GC[\"Cloud DNS\"]\n    OP --&gt; |AWS| R53[\"Route53\"]\n\n    style OP fill:#e8f4f8,stroke:#2196F3,stroke-width:2px\n    style AZ fill:#0078d4,color:#fff,stroke:#0078d4\n    style GC fill:#4285f4,color:#fff,stroke:#4285f4\n    style R53 fill:#ff9900,color:#fff,stroke:#ff9900</code></pre> <ol> <li>Watch \u2014 The operator watches all Ingress resources in the cluster</li> <li>Detect \u2014 When an Ingress is created, modified, or deleted, the operator captures the event</li> <li>Resolve IP \u2014 Uses either the Ingress load balancer IP or a configured <code>customIP</code></li> <li>Sync DNS \u2014 Creates, updates, or deletes the corresponding A record in your cloud DNS provider</li> </ol>"},{"location":"#quick-install","title":"Quick Install","text":"<pre><code>helm install dns-operator \\\n  oci://ghcr.io/marcus1aleksand/helm-charts/hub-and-spoke-dns-operator \\\n  --set cloudProvider=azure \\\n  --set azure.subscriptionId=\"your-sub-id\" \\\n  --set azure.dnsZone=\"example.com\" \\\n  --set azure.dnsResourceGroup=\"rg-dns\" \\\n  --set customIP=\"203.0.113.1\"\n</code></pre> <p> Full installation guide</p>"},{"location":"#supported-providers","title":"Supported Providers","text":"Provider Service Auth Method Status Azure Azure DNS Zones Managed Identity / Workload Identity  Stable GCP Cloud DNS Service Account / Workload Identity  Stable AWS Route53 IRSA / IAM Roles  Stable"},{"location":"architecture/","title":"Architecture","text":""},{"location":"architecture/#overview","title":"Overview","text":"<p>The Hub and Spoke DNS Operator is a Kubernetes operator built with kopf that automates DNS record management for Ingress resources across multi-cloud environments.</p>"},{"location":"architecture/#hub-and-spoke-network-model","title":"Hub-and-Spoke Network Model","text":"<p>In enterprise environments, Kubernetes clusters often run in spoke networks connected to a central hub network that provides shared services like firewalls, VPN gateways, and DNS.</p> <pre><code>graph TB\n    subgraph Hub[\"Hub Network\"]\n        FW[\"Firewall&lt;br/&gt;Public IP: 203.0.113.1\"]\n        DNS[\"DNS Zone&lt;br/&gt;example.com\"]\n    end\n\n    subgraph Spoke1[\"Spoke 1\"]\n        K8S1[\"K8s Cluster\"]\n        OP1[\"DNS Operator\"]\n        ING1[\"Ingress&lt;br/&gt;app1.example.com\"]\n    end\n\n    subgraph Spoke2[\"Spoke 2\"]\n        K8S2[\"K8s Cluster\"]\n        OP2[\"DNS Operator\"]\n        ING2[\"Ingress&lt;br/&gt;app2.example.com\"]\n    end\n\n    FW --&gt;|NAT| K8S1\n    FW --&gt;|NAT| K8S2\n    OP1 --&gt;|\"A record: app1 \u2192 203.0.113.1\"| DNS\n    OP2 --&gt;|\"A record: app2 \u2192 203.0.113.1\"| DNS\n    K8S1 --&gt; ING1\n    K8S2 --&gt; ING2\n    OP1 -.-&gt;|watches| ING1\n    OP2 -.-&gt;|watches| ING2</code></pre>"},{"location":"architecture/#component-design","title":"Component Design","text":""},{"location":"architecture/#provider-abstraction","title":"Provider Abstraction","text":"<p>The operator uses a provider pattern to support multiple cloud DNS services through a unified interface:</p> <pre><code>DNSProvider (Abstract Base)\n\u251c\u2500\u2500 AzureDNSProvider  \u2014 Azure DNS Zones via azure-mgmt-dns\n\u251c\u2500\u2500 GCPDNSProvider    \u2014 Google Cloud DNS via google-cloud-dns\n\u2514\u2500\u2500 AWSDNSProvider    \u2014 AWS Route53 via boto3\n</code></pre> <p>The <code>CLOUD_PROVIDER</code> environment variable selects which provider is instantiated at startup. All providers implement the same <code>create_or_update_record()</code> and <code>delete_record()</code> interface.</p>"},{"location":"architecture/#event-flow","title":"Event Flow","text":"<pre><code>sequenceDiagram\n    participant K8s as Kubernetes API\n    participant Op as DNS Operator\n    participant DNS as Cloud DNS Provider\n\n    K8s-&gt;&gt;Op: Ingress ADDED event\n    Op-&gt;&gt;Op: Extract host, resolve IP\n    Op-&gt;&gt;DNS: create_or_update_record(host, ip, ttl)\n    DNS--&gt;&gt;Op: Success\n    Op-&gt;&gt;Op: Increment Prometheus metrics\n\n    K8s-&gt;&gt;Op: Ingress MODIFIED event\n    Op-&gt;&gt;DNS: create_or_update_record(host, ip, ttl)\n\n    K8s-&gt;&gt;Op: Ingress DELETED event\n    Op-&gt;&gt;DNS: delete_record(host)</code></pre>"},{"location":"architecture/#custom-ip-logic","title":"Custom IP Logic","text":"<p>When <code>customIP</code> is set, the operator uses it instead of the Ingress's load balancer IP \u2014 except when the Ingress uses <code>nginx-internal</code> ingress class (indicating internal-only traffic that shouldn't get the public firewall IP).</p>"},{"location":"architecture/#observability","title":"Observability","text":"<p>The operator exposes Prometheus metrics on <code>:8080/metrics</code> with dimensions for <code>operation</code>, <code>status</code>, and <code>provider</code>, enabling per-cloud-provider monitoring dashboards.</p>"},{"location":"aws-setup/","title":"AWS Route53 Setup Guide","text":""},{"location":"aws-setup/#prerequisites","title":"Prerequisites","text":"<ul> <li>AWS account with Route53 access</li> <li>EKS cluster (or any K8s cluster with AWS access)</li> <li>Helm 3.x installed</li> </ul>"},{"location":"aws-setup/#step-1-create-a-hosted-zone","title":"Step 1: Create a Hosted Zone","text":"<pre><code>aws route53 create-hosted-zone \\\n  --name example.com \\\n  --caller-reference \"$(date +%s)\"\n\n# Note the hosted zone ID from output (e.g., Z1234567890ABC)\n</code></pre>"},{"location":"aws-setup/#step-2-create-iam-policy","title":"Step 2: Create IAM Policy","text":"<pre><code>cat &gt; dns-operator-policy.json &lt;&lt;EOF\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"route53:ChangeResourceRecordSets\",\n        \"route53:ListResourceRecordSets\"\n      ],\n      \"Resource\": \"arn:aws:route53:::hostedzone/Z1234567890ABC\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": \"route53:ListHostedZones\",\n      \"Resource\": \"*\"\n    }\n  ]\n}\nEOF\n\naws iam create-policy \\\n  --policy-name DNSOperatorPolicy \\\n  --policy-document file://dns-operator-policy.json\n</code></pre>"},{"location":"aws-setup/#step-3-configure-authentication","title":"Step 3: Configure Authentication","text":""},{"location":"aws-setup/#option-a-irsa-recommended-for-eks","title":"Option A: IRSA (Recommended for EKS)","text":"<pre><code>eksctl create iamserviceaccount \\\n  --name dnsoperator \\\n  --namespace default \\\n  --cluster my-cluster \\\n  --attach-policy-arn arn:aws:iam::123456789012:policy/DNSOperatorPolicy \\\n  --approve --override-existing-serviceaccounts\n</code></pre> <p>Then install with <code>serviceAccount.create=false</code>:</p> <pre><code>helm install dns-operator oci://ghcr.io/marcus1aleksand/helm-charts/hub-and-spoke-dns-operator \\\n  --set cloudProvider=aws \\\n  --set aws.hostedZoneId=\"Z1234567890ABC\" \\\n  --set aws.dnsZone=\"example.com\" \\\n  --set aws.region=\"us-east-1\" \\\n  --set serviceAccount.create=false \\\n  --set serviceAccount.name=dnsoperator \\\n  --set customIP=\"203.0.113.1\"\n</code></pre>"},{"location":"aws-setup/#option-b-access-keys-development-only","title":"Option B: Access Keys (Development Only)","text":"<pre><code>helm install dns-operator oci://ghcr.io/marcus1aleksand/helm-charts/hub-and-spoke-dns-operator \\\n  --set cloudProvider=aws \\\n  --set aws.hostedZoneId=\"Z1234567890ABC\" \\\n  --set aws.dnsZone=\"example.com\" \\\n  --set aws.region=\"us-east-1\" \\\n  --set aws.accessKeyId=\"AKIA...\" \\\n  --set aws.secretAccessKey=\"...\" \\\n  --set customIP=\"203.0.113.1\"\n</code></pre> <p>\u26a0\ufe0f Warning: Never use access keys in production. Use IRSA or EC2 instance roles instead.</p>"},{"location":"aws-setup/#step-4-verify","title":"Step 4: Verify","text":"<pre><code>kubectl create ingress test --rule=\"test.example.com/*=svc:80\"\naws route53 list-resource-record-sets \\\n  --hosted-zone-id Z1234567890ABC \\\n  --query \"ResourceRecordSets[?Name=='test.example.com.']\"\n</code></pre>"},{"location":"azure-setup/","title":"Azure DNS Setup Guide","text":""},{"location":"azure-setup/#prerequisites","title":"Prerequisites","text":"<ul> <li>Azure subscription with a DNS Zone</li> <li>AKS cluster with Managed Identity (or Workload Identity) enabled</li> <li>Helm 3.x installed</li> </ul>"},{"location":"azure-setup/#step-1-create-azure-dns-zone","title":"Step 1: Create Azure DNS Zone","text":"<pre><code>az group create --name rg-dns --location eastus\naz network dns zone create --resource-group rg-dns --name example.com\n</code></pre>"},{"location":"azure-setup/#step-2-configure-managed-identity","title":"Step 2: Configure Managed Identity","text":"<pre><code># Get the managed identity principal ID\nIDENTITY_CLIENT_ID=$(az aks show -g rg-k8s -n my-cluster \\\n  --query \"identityProfile.kubeletidentity.clientId\" -o tsv)\n\n# Assign DNS Zone Contributor role\nDNS_ZONE_ID=$(az network dns zone show -g rg-dns -n example.com --query id -o tsv)\naz role assignment create \\\n  --assignee $IDENTITY_CLIENT_ID \\\n  --role \"DNS Zone Contributor\" \\\n  --scope $DNS_ZONE_ID\n</code></pre>"},{"location":"azure-setup/#step-3-install-the-operator","title":"Step 3: Install the Operator","text":"<pre><code>helm install dns-operator oci://ghcr.io/marcus1aleksand/helm-charts/hub-and-spoke-dns-operator \\\n  --set cloudProvider=azure \\\n  --set azure.subscriptionId=\"$(az account show --query id -o tsv)\" \\\n  --set azure.dnsZone=\"example.com\" \\\n  --set azure.dnsResourceGroup=\"rg-dns\" \\\n  --set azure.managedIdentityClientId=\"$IDENTITY_CLIENT_ID\" \\\n  --set customIP=\"203.0.113.1\" \\\n  --set customTTL=300\n</code></pre>"},{"location":"azure-setup/#step-4-verify","title":"Step 4: Verify","text":"<p>Create a test ingress and verify the DNS record:</p> <pre><code>kubectl create ingress test --rule=\"test.example.com/*=svc:80\"\naz network dns record-set a show -g rg-dns -z example.com -n test\n</code></pre>"},{"location":"azure-setup/#migration-from-v01x","title":"Migration from v0.1.x","text":"<p>If upgrading from v0.1.x (Azure-only), the only change is: - A new <code>cloudProvider: azure</code> value is added (defaults to <code>azure</code>, so no action needed) - The <code>serviceAccount.name</code> default changed from <code>azurednsoperator</code> to <code>dnsoperator</code></p> <p>Your existing values files will continue to work without changes.</p>"},{"location":"configuration/","title":"Configuration Reference","text":"<p>Complete reference for all Helm chart values.</p>"},{"location":"configuration/#common-values","title":"Common Values","text":"Parameter Type Default Description <code>cloudProvider</code> string <code>azure</code> Cloud provider: <code>azure</code>, <code>gcp</code>, or <code>aws</code> <code>customIP</code> string <code>\"\"</code> Override IP for DNS records (e.g., firewall public IP) <code>customTTL</code> int <code>300</code> TTL for DNS records in seconds <code>replicaCount</code> int <code>1</code> Number of operator replicas <code>image.repository</code> string <code>ghcr.io/marcus1aleksand/hub-and-spoke-dns-operator</code> Container image <code>image.pullPolicy</code> string <code>Always</code> Image pull policy <code>imageCredentials</code> string <code>\"\"</code> Image pull secret <code>fullnameOverride</code> string <code>\"\"</code> Override the full resource name <code>nameOverride</code> string <code>\"\"</code> Override the chart name <code>metrics.enabled</code> bool <code>true</code> Enable Prometheus metrics endpoint <code>metrics.serviceMonitor.enabled</code> bool <code>false</code> Create ServiceMonitor for Prometheus Operator"},{"location":"configuration/#service-account","title":"Service Account","text":"Parameter Type Default Description <code>serviceAccount.create</code> bool <code>true</code> Create a service account <code>serviceAccount.name</code> string <code>dnsoperator</code> Service account name <code>deployment.automountServiceAccountToken</code> bool <code>false</code> Automount SA token"},{"location":"configuration/#azure-dns-values","title":"Azure DNS Values","text":"Parameter Type Default Description <code>azure.subscriptionId</code> string <code>\"\"</code> Azure subscription ID <code>azure.dnsZone</code> string <code>\"\"</code> DNS zone name (e.g., <code>example.com</code>) <code>azure.dnsResourceGroup</code> string <code>\"\"</code> Resource group containing the DNS zone <code>azure.managedIdentityClientId</code> string <code>\"\"</code> Managed Identity client ID"},{"location":"configuration/#google-cloud-dns-values","title":"Google Cloud DNS Values","text":"Parameter Type Default Description <code>gcp.projectId</code> string <code>\"\"</code> GCP project ID <code>gcp.managedZone</code> string <code>\"\"</code> Cloud DNS managed zone name <code>gcp.dnsZone</code> string <code>\"\"</code> DNS zone domain (e.g., <code>example.com</code>) <code>gcp.serviceAccountKey</code> string <code>\"\"</code> K8s secret name containing GCP SA key"},{"location":"configuration/#aws-route53-values","title":"AWS Route53 Values","text":"Parameter Type Default Description <code>aws.hostedZoneId</code> string <code>\"\"</code> Route53 hosted zone ID <code>aws.dnsZone</code> string <code>\"\"</code> DNS zone domain (e.g., <code>example.com</code>) <code>aws.region</code> string <code>\"\"</code> AWS region <code>aws.accessKeyId</code> string <code>\"\"</code> AWS access key (dev only) <code>aws.secretAccessKey</code> string <code>\"\"</code> AWS secret key (dev only) <p>Production Security</p> <p>Never use <code>aws.accessKeyId</code> / <code>aws.secretAccessKey</code> in production. Use IRSA (IAM Roles for Service Accounts) instead.</p>"},{"location":"configuration/#example-valuesyaml","title":"Example values.yaml","text":"<pre><code>cloudProvider: azure\n\ncustomIP: \"203.0.113.1\"\ncustomTTL: 300\nreplicaCount: 1\n\nazure:\n  subscriptionId: \"00000000-0000-0000-0000-000000000000\"\n  dnsZone: \"example.com\"\n  dnsResourceGroup: \"rg-dns\"\n  managedIdentityClientId: \"00000000-0000-0000-0000-000000000000\"\n\nmetrics:\n  enabled: true\n  serviceMonitor:\n    enabled: true\n\nserviceAccount:\n  create: true\n  name: \"dnsoperator\"\n</code></pre>"},{"location":"contributing/","title":"Contributing","text":"<p>We welcome contributions! Here's how to get started.</p>"},{"location":"contributing/#development-setup","title":"Development Setup","text":"<ol> <li> <p>Fork and clone the repository:     <pre><code>git clone https://github.com/YOUR-USERNAME/hub-and-spoke-dns-operator.git\ncd hub-and-spoke-dns-operator\n</code></pre></p> </li> <li> <p>Install pre-commit hooks: <pre><code>brew install pre-commit\npre-commit install\n</code></pre></p> </li> <li> <p>Install Python dependencies: <pre><code>cd operator\npip install -r requirements.txt\n</code></pre></p> </li> <li> <p>Run tests: <pre><code>python -m pytest test_main.py -v\n</code></pre></p> </li> </ol>"},{"location":"contributing/#project-structure","title":"Project Structure","text":"<pre><code>hub-and-spoke-dns-operator/\n\u251c\u2500\u2500 operator/                    # Python operator source\n\u2502   \u251c\u2500\u2500 main.py                  # Main operator logic\n\u2502   \u251c\u2500\u2500 providers/               # Cloud DNS provider implementations\n\u2502   \u2502   \u251c\u2500\u2500 base.py              # Abstract base provider\n\u2502   \u2502   \u251c\u2500\u2500 azure.py             # Azure DNS provider\n\u2502   \u2502   \u251c\u2500\u2500 gcp.py               # Google Cloud DNS provider\n\u2502   \u2502   \u2514\u2500\u2500 aws.py               # AWS Route53 provider\n\u2502   \u251c\u2500\u2500 test_main.py             # Unit tests\n\u2502   \u251c\u2500\u2500 Dockerfile               # Container image\n\u2502   \u2514\u2500\u2500 requirements.txt         # Python dependencies\n\u251c\u2500\u2500 charts/                      # Helm chart\n\u2502   \u251c\u2500\u2500 Chart.yaml\n\u2502   \u251c\u2500\u2500 values.yaml\n\u2502   \u2514\u2500\u2500 templates/\n\u251c\u2500\u2500 docs/                        # Documentation (MkDocs)\n\u2514\u2500\u2500 secrets-injector/            # External secrets integration\n</code></pre>"},{"location":"contributing/#pull-request-process","title":"Pull Request Process","text":"<ol> <li>Create a feature branch: <code>git checkout -b feature/amazing-feature</code></li> <li>Make your changes and ensure tests pass</li> <li>Pre-commit hooks will run automatically on <code>git commit</code></li> <li>Push and open a Pull Request against <code>main</code></li> </ol>"},{"location":"contributing/#ci-pipeline","title":"CI Pipeline","text":"<p>All PRs trigger:</p> <ul> <li>Lint &amp; Security Scan \u2014 Flake8 linting + Checkov security scanning</li> <li>Build &amp; Test \u2014 Docker build verification</li> <li>Unit Tests \u2014 Python test suite</li> </ul>"},{"location":"contributing/#code-of-conduct","title":"Code of Conduct","text":"<p>Be kind, be respectful, and help make this project welcoming for everyone.</p>"},{"location":"contributing/#license","title":"License","text":"<p>By contributing, you agree that your contributions will be licensed under the MIT License.</p>"},{"location":"gcp-setup/","title":"Google Cloud DNS Setup Guide","text":""},{"location":"gcp-setup/#prerequisites","title":"Prerequisites","text":"<ul> <li>GCP project with Cloud DNS API enabled</li> <li>GKE cluster (or any K8s cluster with GCP access)</li> <li>Helm 3.x installed</li> </ul>"},{"location":"gcp-setup/#step-1-enable-cloud-dns-api","title":"Step 1: Enable Cloud DNS API","text":"<pre><code>gcloud services enable dns.googleapis.com\n</code></pre>"},{"location":"gcp-setup/#step-2-create-a-managed-zone","title":"Step 2: Create a Managed Zone","text":"<pre><code>gcloud dns managed-zones create my-dns-zone \\\n  --dns-name=\"example.com.\" \\\n  --description=\"Production DNS zone\"\n</code></pre>"},{"location":"gcp-setup/#step-3-create-service-account","title":"Step 3: Create Service Account","text":"<pre><code># Create service account\ngcloud iam service-accounts create dns-operator \\\n  --display-name=\"Hub and Spoke DNS Operator\"\n\n# Grant DNS admin role\ngcloud projects add-iam-policy-binding my-gcp-project \\\n  --member=\"serviceAccount:dns-operator@my-gcp-project.iam.gserviceaccount.com\" \\\n  --role=\"roles/dns.admin\"\n\n# Create and download key\ngcloud iam service-accounts keys create key.json \\\n  --iam-account=dns-operator@my-gcp-project.iam.gserviceaccount.com\n\n# Store as Kubernetes secret\nkubectl create secret generic gcp-dns-sa-key --from-file=key.json=key.json\n</code></pre>"},{"location":"gcp-setup/#step-4-install-the-operator","title":"Step 4: Install the Operator","text":"<pre><code>helm install dns-operator oci://ghcr.io/marcus1aleksand/helm-charts/hub-and-spoke-dns-operator \\\n  --set cloudProvider=gcp \\\n  --set gcp.projectId=\"my-gcp-project\" \\\n  --set gcp.managedZone=\"my-dns-zone\" \\\n  --set gcp.dnsZone=\"example.com\" \\\n  --set gcp.serviceAccountKey=\"gcp-dns-sa-key\" \\\n  --set customIP=\"203.0.113.1\"\n</code></pre>"},{"location":"gcp-setup/#step-5-verify","title":"Step 5: Verify","text":"<pre><code>kubectl create ingress test --rule=\"test.example.com/*=svc:80\"\ngcloud dns record-sets list --zone=my-dns-zone --filter=\"name=test.example.com.\"\n</code></pre>"},{"location":"gcp-setup/#using-workload-identity-recommended-for-gke","title":"Using Workload Identity (Recommended for GKE)","text":"<p>Instead of a service account key, use GKE Workload Identity:</p> <pre><code># Bind K8s SA to GCP SA\ngcloud iam service-accounts add-iam-policy-binding \\\n  dns-operator@my-gcp-project.iam.gserviceaccount.com \\\n  --role roles/iam.workloadIdentityUser \\\n  --member \"serviceAccount:my-gcp-project.svc.id.goog[default/dnsoperator]\"\n\n# Annotate the K8s service account (via Helm values or kubectl)\nkubectl annotate serviceaccount dnsoperator \\\n  iam.gke.io/gcp-service-account=dns-operator@my-gcp-project.iam.gserviceaccount.com\n</code></pre> <p>When using Workload Identity, omit the <code>gcp.serviceAccountKey</code> value.</p>"},{"location":"metrics/","title":"Metrics &amp; Monitoring","text":"<p>The operator exposes Prometheus metrics on port <code>8080</code> at <code>/metrics</code>.</p>"},{"location":"metrics/#available-metrics","title":"Available Metrics","text":"Metric Type Labels Description <code>dns_operator_operations_total</code> Counter <code>operation</code>, <code>status</code>, <code>provider</code> Total DNS operations performed <code>dns_operator_operation_duration_seconds</code> Histogram <code>operation</code>, <code>provider</code> Duration of DNS operations <code>dns_operator_errors_total</code> Counter <code>error_type</code> DNS operation errors by type <code>dns_operator_records_managed</code> Gauge \u2014 Number of currently managed DNS records <code>dns_operator_info</code> Gauge <code>zone</code>, <code>provider</code>, <code>version</code> Operator metadata"},{"location":"metrics/#prometheus-servicemonitor","title":"Prometheus ServiceMonitor","text":"<p>Enable the ServiceMonitor to auto-discover metrics with the Prometheus Operator:</p> <pre><code>metrics:\n  enabled: true\n  serviceMonitor:\n    enabled: true\n</code></pre>"},{"location":"metrics/#example-promql-queries","title":"Example PromQL Queries","text":"<pre><code># DNS operations per minute by provider\nrate(dns_operator_operations_total[5m])\n\n# Error rate\nrate(dns_operator_errors_total[5m])\n\n# Average operation latency (p95)\nhistogram_quantile(0.95, rate(dns_operator_operation_duration_seconds_bucket[5m]))\n\n# Currently managed records\ndns_operator_records_managed\n</code></pre>"},{"location":"metrics/#grafana-dashboard","title":"Grafana Dashboard","text":"<p>You can create a Grafana dashboard with panels for:</p> <ul> <li>Operations rate \u2014 <code>rate(dns_operator_operations_total[5m])</code> by operation type</li> <li>Error rate \u2014 <code>rate(dns_operator_errors_total[5m])</code> by error type</li> <li>Latency \u2014 p50/p95/p99 of <code>dns_operator_operation_duration_seconds</code></li> <li>Managed records \u2014 <code>dns_operator_records_managed</code> gauge</li> </ul>"},{"location":"providers/","title":"Cloud Providers Overview","text":"<p>The Hub and Spoke DNS Operator uses a provider abstraction pattern to support multiple cloud DNS services through a unified interface.</p>"},{"location":"providers/#provider-architecture","title":"Provider Architecture","text":"<pre><code>classDiagram\n    class DNSProvider {\n        &lt;&lt;abstract&gt;&gt;\n        +create_or_update_record(host, ip, ttl)\n        +delete_record(host)\n    }\n    class AzureDNSProvider {\n        +azure-mgmt-dns SDK\n    }\n    class GCPDNSProvider {\n        +google-cloud-dns SDK\n    }\n    class AWSDNSProvider {\n        +boto3 SDK\n    }\n    DNSProvider &lt;|-- AzureDNSProvider\n    DNSProvider &lt;|-- GCPDNSProvider\n    DNSProvider &lt;|-- AWSDNSProvider</code></pre> <p>The <code>cloudProvider</code> Helm value (or <code>CLOUD_PROVIDER</code> environment variable) selects which provider is instantiated at startup.</p>"},{"location":"providers/#comparison","title":"Comparison","text":"Feature Azure DNS Google Cloud DNS AWS Route53 Auth Method Managed Identity / Workload Identity Service Account Key / Workload Identity IRSA / Access Keys Record Types A records A records A records Zone Type Public DNS Zone Managed Zone Hosted Zone Required Role <code>DNS Zone Contributor</code> <code>roles/dns.admin</code> <code>route53:Change/ListResourceRecordSets</code> SDK <code>azure-mgmt-dns</code> <code>google-cloud-dns</code> <code>boto3</code>"},{"location":"providers/#choosing-a-provider","title":"Choosing a Provider","text":"<p>All three providers offer the same core functionality. Choose based on where your DNS zone is hosted:</p> <ul> <li>Azure DNS \u2014 Best for Azure-native environments with AKS and Managed Identity</li> <li>Google Cloud DNS \u2014 Best for GCP environments with GKE and Workload Identity</li> <li>AWS Route53 \u2014 Best for AWS environments with EKS and IRSA</li> </ul> <p>Multi-cloud DNS</p> <p>You can run multiple instances of the operator in the same cluster, each configured with a different provider, to manage DNS records across multiple cloud providers simultaneously.</p>"},{"location":"providers/#setup-guides","title":"Setup Guides","text":"<ul> <li> Azure DNS Setup</li> <li> Google Cloud DNS Setup</li> <li> AWS Route53 Setup</li> </ul>"},{"location":"quickstart/","title":"Quick Start","text":"<p>Get the Hub and Spoke DNS Operator running in your cluster in minutes.</p>"},{"location":"quickstart/#prerequisites","title":"Prerequisites","text":"<ul> <li>Kubernetes 1.28+</li> <li>Helm 3.x</li> <li>Cloud provider credentials configured (see provider-specific guides)</li> </ul>"},{"location":"quickstart/#installation","title":"Installation","text":""},{"location":"quickstart/#step-1-choose-your-cloud-provider","title":"Step 1: Choose Your Cloud Provider","text":"Azure DNSGoogle Cloud DNSAWS Route53 <pre><code>helm install dns-operator \\\n  oci://ghcr.io/marcus1aleksand/helm-charts/hub-and-spoke-dns-operator \\\n  --set cloudProvider=azure \\\n  --set azure.subscriptionId=\"your-subscription-id\" \\\n  --set azure.dnsZone=\"example.com\" \\\n  --set azure.dnsResourceGroup=\"rg-dns\" \\\n  --set azure.managedIdentityClientId=\"your-mi-client-id\" \\\n  --set customIP=\"203.0.113.1\"\n</code></pre> <p> Full Azure setup guide</p> <pre><code>helm install dns-operator \\\n  oci://ghcr.io/marcus1aleksand/helm-charts/hub-and-spoke-dns-operator \\\n  --set cloudProvider=gcp \\\n  --set gcp.projectId=\"my-gcp-project\" \\\n  --set gcp.managedZone=\"my-dns-zone\" \\\n  --set gcp.dnsZone=\"example.com\" \\\n  --set gcp.serviceAccountKey=\"gcp-dns-sa-key\" \\\n  --set customIP=\"203.0.113.1\"\n</code></pre> <p> Full GCP setup guide</p> <pre><code>helm install dns-operator \\\n  oci://ghcr.io/marcus1aleksand/helm-charts/hub-and-spoke-dns-operator \\\n  --set cloudProvider=aws \\\n  --set aws.hostedZoneId=\"Z1234567890ABC\" \\\n  --set aws.dnsZone=\"example.com\" \\\n  --set aws.region=\"us-east-1\" \\\n  --set customIP=\"203.0.113.1\"\n</code></pre> <p> Full AWS setup guide</p>"},{"location":"quickstart/#step-2-verify-the-installation","title":"Step 2: Verify the Installation","text":"<pre><code># Check the operator is running\nkubectl get pods -l app.kubernetes.io/name=hub-and-spoke-dns-operator\n\n# Check logs\nkubectl logs -l app.kubernetes.io/name=hub-and-spoke-dns-operator -f\n</code></pre>"},{"location":"quickstart/#step-3-test-dns-record-creation","title":"Step 3: Test DNS Record Creation","text":"<pre><code># Create a test ingress\nkubectl create ingress test-app \\\n  --rule=\"test.example.com/*=my-service:80\"\n\n# Verify the DNS record was created (Azure example)\naz network dns record-set a show -g rg-dns -z example.com -n test\n</code></pre>"},{"location":"quickstart/#step-4-clean-up-test","title":"Step 4: Clean Up Test","text":"<pre><code>kubectl delete ingress test-app\n# The DNS record will be automatically deleted\n</code></pre>"},{"location":"quickstart/#whats-next","title":"What's Next?","text":"<ul> <li> Understand the architecture</li> <li> Full configuration reference</li> <li> Set up monitoring</li> <li> Troubleshooting guide</li> </ul>"},{"location":"troubleshooting/","title":"Troubleshooting","text":"<p>Common issues and their solutions.</p>"},{"location":"troubleshooting/#operator-not-starting","title":"Operator Not Starting","text":""},{"location":"troubleshooting/#pod-in-crashloopbackoff","title":"Pod in CrashLoopBackOff","text":"<pre><code>kubectl logs -l app.kubernetes.io/name=hub-and-spoke-dns-operator\n</code></pre> <p>Common causes:</p> <ul> <li>Missing or invalid cloud provider credentials</li> <li>Incorrect <code>cloudProvider</code> value</li> <li>DNS zone doesn't exist or is inaccessible</li> </ul>"},{"location":"troubleshooting/#authentication-errors","title":"Authentication Errors","text":"AzureGCPAWS <pre><code>DefaultAzureCredential failed: ManagedIdentityCredential authentication unavailable\n</code></pre> <p>Fix: Ensure Managed Identity is properly assigned and has <code>DNS Zone Contributor</code> role on the DNS zone.</p> <pre><code>az role assignment list --assignee &lt;managed-identity-client-id&gt; --scope &lt;dns-zone-id&gt;\n</code></pre> <pre><code>google.auth.exceptions.DefaultCredentialsError\n</code></pre> <p>Fix: Verify the Kubernetes secret exists and contains a valid service account key:</p> <pre><code>kubectl get secret gcp-dns-sa-key -o jsonpath='{.data.key\\.json}' | base64 -d | jq .\n</code></pre> <pre><code>botocore.exceptions.NoCredentialsError\n</code></pre> <p>Fix: Verify IRSA is configured correctly:</p> <pre><code>kubectl describe sa dnsoperator | grep -i annotation\n</code></pre>"},{"location":"troubleshooting/#dns-records-not-created","title":"DNS Records Not Created","text":"<ol> <li> <p>Check operator logs for event processing:     <pre><code>kubectl logs -l app.kubernetes.io/name=hub-and-spoke-dns-operator -f\n</code></pre></p> </li> <li> <p>Verify the Ingress has a hostname:     <pre><code>kubectl get ingress -o wide\n</code></pre></p> </li> <li> <p>Check permissions \u2014 the operator needs read access to Ingress resources:     <pre><code>kubectl auth can-i watch ingresses --as=system:serviceaccount:default:dnsoperator\n</code></pre></p> </li> </ol>"},{"location":"troubleshooting/#dns-records-not-deleted","title":"DNS Records Not Deleted","text":"<p>Records should be deleted when the corresponding Ingress is removed. If not:</p> <ol> <li>Check logs for deletion events</li> <li>Verify the operator was running when the Ingress was deleted</li> <li>Manually clean up orphaned records if necessary</li> </ol>"},{"location":"troubleshooting/#metrics-not-available","title":"Metrics Not Available","text":"<pre><code># Port-forward to the metrics endpoint\nkubectl port-forward deploy/dns-operator 8080:8080\ncurl http://localhost:8080/metrics\n</code></pre> <p>If metrics are empty, ensure <code>metrics.enabled=true</code> in your Helm values.</p>"},{"location":"troubleshooting/#getting-help","title":"Getting Help","text":"<ul> <li> Open an issue</li> <li> Check the docs</li> </ul>"}]}